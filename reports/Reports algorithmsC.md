[simulink](simulink)

[cubemx](CubeMX.md)

Настройка Simulink для работы через него с Stm32

 - Выбор платы (HARDWARE -> HARDWARE Setings -> Hardware implementation -> Hardware Board)
- Выбор необходимого ioc файла (HARDWARE -> HARDWARE Setings -> Hardware implementation -> Hardware Board -> Hardware board setings -> target hardware resources -> build options -> STM32CubeMX project file(Browse) )
- При работе с UART необходимо выбрать канал и порт ( HARDWARE -> HARDWARE Setings -> Hardware implementation -> Hardware Board -> Hardware board setings -> target hardware resources -> connectivity)
- При работе с ШИМ необходимо выставить continous time ( HARDWARE -> HARDWARE Setings -> Code Generation -> Interface  -> software enviromment)

### Ошибка visibility(static) 

Если галочки у visibility(static) в СubeMX project Manager -> Advanced Settings -> Generated Funcion Calls не кликабельны, то нужно пересоздать проект, и при создании проекта отжать все галочки. 

### Концепция PIL

Мы строим модель реальной системы в Simulink. Производим имитацию физических данных для микроконтроллера через Simulink. Контроллер не знает, что данные получены из эмуляции - для него данные выглядят как реальные физические сигналы. Контроллер отрабатывает заданный алгоритм, получая данные через Simulink. 

!! Требуется точная настройка таймингов(эмуляция может работать быстрее/медленнее реальной модели)

HIL - тестирование с реальными датчиками/ MIL - все на ПК.

----
18.07

![screen](https://github.com/Kostya545215/practice_alg_c/blob/main/images/Pasted%20image%2020250718130946.png)
Если подавать непрерывный сигнал, то выходит какой-то бред. Синусоида подтягивает тики из блока импульса, и мигания происходит не плавно, а в такт импульсу из верхнего блока(который даже не подключен к светодиодам). Чтобы мигало плавно, и были тики с нужной нам частотой, в синусе был выставлен sample time.

Нельзя создавать несколько одинаковых блоков pwm output. На второе его подключение он просто никак не реагирует, хотя сигнал поступает. 

Нужно формировать сигнал, выбирать из всех нужный, а уже после отправлять его на этот один единственный блок.

---
21.07

Что можно заменить блоком PIL? - какой-то блок с кодом, например контроллер/регулятор.

QEMU Emulator - эмулятор stm32. Он нужен если нет реальной stm32, а хочет позапускать процессы как будто бы на реальном микроконтроллере. 


![screen](https://github.com/Kostya545215/practice_alg_c/blob/main/images/Pasted%20image%2020250721231228.png)
только 0.000125, а не 0.008, чтобы было 8 кГц

поменял все непрерывное, на все дискретное!


---

22.07

- настроить директорию C:\Users\Konstantin\Documents\MATLAB\Examples\R2024a\stm32f4discovery\CodeVerificationAndValidationWithPILSTM32F4xxBasedBoardsExample\Subsystem_ert_rtw для работы в cubeide с генерируемый кодом.
- будет ли конфликт, если работать одновременно и в cubeide, и в matlab - да, будет. нельзя оставлять в файле main функцию main, если хотим заливать в МК что-то из simulink. надо ее комментировать/удалять.

изменение пути генерации файлов
![screen](https://github.com/Kostya545215/practice_alg_c/blob/main/images/Pasted%20image%2020250722175222.png)

не то. путь меняется, но как-то криво файлы генерируемые Embedded Coder там располагаются. можно в matlab поменять папку, в которой работаем, тогда и файлы будут генерироваться в другой папке.  

---
23.07
- можно ли просто добавить все файлы, формируемые simulink, и подключить через include основной файл симулинка в main.c проекта?

работа с анализатором - вроде без каких-то проблем/подноготной.

В С/С++ code block можно писать код на Срр. Т.е да, можно работать с кодом c++, а не только с. 

Test Manager открывается командой sltest.testmanager.view (необходим для одного из способов добавления си кода в блок, и его отладки)

statitc - если нужно, чтобы переменная сохраняла свое значение между вызовами функции
extern - объявление переменной(если написать int num 5, то это будет определение переменной и под него выделится память, а с extern такого не будет)

!!!!! все-таки, если задавать main(void) в cubeide, то потом код в simulink не собирается.

для того, чтобы работало прерывание, нужно в pinout & configuration -> system core -> nvic поставить галочку у EXTI line[15:10] interrupts

чтобы таймер работал, надо не забывать включать MX_Tim...

---
24.07

Насколько я понимаю, нельзя написать код в CubeIDE, например, а потом просто запихнуть его в какой-нибудь блок Simulink. Можно написать просто код на C, чтобы проверить логику работы, но прям полностью загрузить код, написанный под stm32 в simulink не получится. 

Можно написать код на C и потом через Test Manager его загрузить и проверить. Для этого нужно формировать еще header файл.

Можно не писать отдельно код, а проверить логику алгоритма через S-Function Builder. Настроить выходы, прописать вручную, перед входами и выходами ставя звездочку.
