[simulink](simulink)

[cubemx](CubeMX.md)

Настройка Simulink для работы через него с Stm32

 - Выбор платы (HARDWARE -> HARDWARE Setings -> Hardware implementation -> Hardware Board)
- Выбор необходимого ioc файла (HARDWARE -> HARDWARE Setings -> Hardware implementation -> Hardware Board -> Hardware board setings -> target hardware resources -> build options -> STM32CubeMX project file(Browse) )
- При работе с UART необходимо выбрать канал и порт ( HARDWARE -> HARDWARE Setings -> Hardware implementation -> Hardware Board -> Hardware board setings -> target hardware resources -> connectivity)
- При работе с ШИМ необходимо выставить continous time ( HARDWARE -> HARDWARE Setings -> Code Generation -> Interface  -> software enviromment)

### Ошибка visibility(static) 

Если галочки у visibility(static) в СubeMX project Manager -> Advanced Settings -> Generated Funcion Calls не кликабельны, то нужно пересоздать проект, и при создании проекта отжать все галочки. 

### Концепция PIL

Мы строим модель реальной системы в Simulink. Производим имитацию физических данных для микроконтроллера через Simulink. Контроллер не знает, что данные получены из эмуляции - для него данные выглядят как реальные физические сигналы. Контроллер отрабатывает заданный алгоритм, получая данные через Simulink. 

!! Требуется точная настройка таймингов(эмуляция может работать быстрее/медленнее реальной модели)

HIL - тестирование с реальными датчиками/ MIL - все на ПК.

----
18.07

![[Pasted image 20250718130946.png]]
Если подавать непрерывный сигнал, то выходит какой-то бред. Синусоида подтягивает тики из блока импульса, и мигания происходит не плавно, а в такт импульсу из верхнего блока(который даже не подключен к светодиодам). Чтобы мигало плавно, и были тики с нужной нам частотой, в синусе был выставлен sample time.

Нельзя создавать несколько одинаковых блоков pwm output. На второе его подключение он просто никак не реагирует, хотя сигнал поступает. 

Нужно формировать сигнал, выбирать из всех нужный, а уже после отправлять его на этот один единственный блок.

---
21.07

Что можно заменить блоком PIL? - какой-то блок с кодом, например контроллер/регулятор.

QEMU Emulator - эмулятор stm32. Он нужен если нет реальной stm32, а хочет позапускать процессы как будто бы на реальном микроконтроллере. 


![[Pasted image 20250721231228.png]]
только 0.000125, а не 0.008, чтобы было 8 кГц

поменял все непрерывное, на все дискретное!


---

22.07

- настроить директорию C:\Users\Konstantin\Documents\MATLAB\Examples\R2024a\stm32f4discovery\CodeVerificationAndValidationWithPILSTM32F4xxBasedBoardsExample\Subsystem_ert_rtw для работы в cubeide с генерируемый кодом.
- будет ли конфликт, если работать одновременно и в cubeide, и в matlab
- понять можно ли выставить прерывание 0.125 мс (на 8 кГц)
- способна ли работать модель на 8 кГц

изменение пути генерации файлов
![[Pasted image 20250722175222.png]]

не то.
как поменять путь генерации си файлов при 

---
23.07

У меня отправляется 'а' в vscode и у меня мигают лампочки. Нужно как-то связать файлы simulink и cubeide, чтобы я мог что-то 

- можно ли просто добавить все файлы, формируемые simulink, и подключить через include основной файл симулинка в main.c проекта?

работа с анализатором
да, можно добавлять код c++, а не только с.
Test Manager открывается командой sltest.testmanager.view

statitc - если нужно, чтобы переменная сохраняла свое значение между вызовами функции
extern - объявление переменной(если написать int num 5, то это будет определение переменной и под него выделится память, а с extern такого не будет)

!!!!! все-таки, если задавать main(void) в cubeide, то потом код в simulink не собирается.

для того, чтобы работало прерывание, нужно в pinout & configuration -> system core -> nvic поставить галочку у EXTI line[15:10] interrupts

чтобы таймер работал, надо не забывать включать MX_Tim...

---
24.07

Насколько я понимаю, нельзя написать код в CubeIDE, например, а потом просто запихнуть его в какой-нибудь блок Simulink. Можно написать просто код на C, чтобы проверить логику работы, но прям полностью загрузить код, написанный под stm32 в simulink не получится. 

Можно написать код на C и потом через Test Manager его загрузить и проверить. Для этого нужно формировать еще header файл.

Можно не писать отдельно код, а проверить логику алгоритма через S-Function. Настроить выходы, прописать вручную, перед входами и выходами ставя звездочку.